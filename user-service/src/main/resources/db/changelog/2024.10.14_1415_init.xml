<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd">

  <changeSet id="2024.10.14_1415_init_1" author="VekovshininAYU">
    <comment>Добавление базовой последовательности</comment>

    <createSequence sequenceName="base_seq" minValue="1" startValue="1"/>
  </changeSet>

  <changeSet id="2024.10.14_1415_init_2" author="VekovshininAYU">
    <comment>Добавление таблицы users</comment>

    <createTable tableName="users" remarks="Таблица пользователей">
      <column name="entity_id" type="bigint"
        remarks="Id пользователя">
        <constraints
          nullable="false"
          primaryKey="true" primaryKeyName="pk_users"/>
      </column>

      <column name="username" type="varchar(1024)"
        remarks="Логин пользователя">
      </column>

      <column name="email" type="varchar(1024)"
        remarks="Email пользователя">
      </column>

      <column name="password" type="varchar(4000)"
        remarks="Пароль пользователя в зашифрованном виде">
      </column>

      <column name="created_at" type="timestamp with time zone"
        remarks="Дата создания записи">
      </column>

      <column name="changed_at" type="timestamp with time zone"
        remarks="Дата изменения записи">
      </column>
    </createTable>
  </changeSet>

  <changeSet id="2024.10.14_1415_init_3" author="VekovshininAYU">
    <comment>Добавление таблицы связей user_role_lnk</comment>

    <createTable tableName="user_role_lnk" remarks="Таблица связей пользователь-роли">
      <column name="user_id" type="bigint" remarks="Id пользователя">
        <constraints nullable="false"/>
      </column>

      <column name="role_id" type="bigint" remarks="Id роли">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addPrimaryKey tableName="user_role_lnk" columnNames="user_id,role_id"
      constraintName="pk_user_role_lnk"/>

    <addForeignKeyConstraint baseTableName="user_role_lnk" baseColumnNames="user_id"
      constraintName="fk_users"
      referencedTableName="users" referencedColumnNames="entity_id"/>
  </changeSet>

</databaseChangeLog>
